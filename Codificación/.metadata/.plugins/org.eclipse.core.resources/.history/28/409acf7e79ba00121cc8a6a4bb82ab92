package datos;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.Collection;

public class CatalogoCategorias 
{
	//ATRIBUTOS
	private Collection<datos.Categoria> categorias;

	
	//CONSTRUCTOR
	public CatalogoCategorias() 
	{
		this.categorias = new ArrayList<datos.Categoria>();
	}


	//GETTER & SETTERS
	public Collection<datos.Categoria> getCategorias() 
	{
		return categorias;
	}

	public void setCategorias(Collection<datos.Categoria> categorias) 
	{
		this.categorias = categorias;
	}
	

	
	//METODOS
	//-------------------------------------------------------------
	public Collection<datos.Categoria> obtenerCategorias()
	{
		ResultSet conjuntoResult = null;
		datos.BDConector conector = null;
		
		
		try
		{
			
			conector = new datos.BDConector(datos.BDConstantes.URL_BD, 
					datos.BDConstantes.PORT, 
					datos.BDConstantes.DATABASE, 
					datos.BDConstantes.USER, 
					datos.BDConstantes.PASS);
			

			conjuntoResult = conector.ejecutaPeticion("CALL obtenerCategorias");
					
			
			while( conjuntoResult.next() )
			{
				//se define categoria temporal
				datos.Categoria ctg = new datos.Categoria();
				
				//se setean atributos de categoria
				ctg.setIdCategoria(conjuntoResult.getInt("idCategoria"));
				ctg.setDescripcion(conjuntoResult.getString("descripcion"));
				
				//se crea subcat temporal
				Collection<datos.SubCategoria> subcategorias = new ArrayList<datos.SubCategoria>();

				
				while (ctg.getIdCategoria() == 1)
				{
					datos.SubCategoria sctg = new datos.SubCategoria();

					sctg.setIdSubcategoria(conjuntoResult.getInt("idSubcategoria"));
					sctg.setDescripcion(conjuntoResult.getString("descSubcategoria"));
					
					subcategorias.add(sctg);
	
				}
				ctg.setSubCats(subcategorias);
				
				//agregar productos
				
				categorias.add(ctg);
			}			
		}
		catch ( SQLException excepcionSql)
		{
			excepcionSql.printStackTrace();
		}
		finally
		{
			try
			{
				conjuntoResult.close();
				conector.cierraConexion();
			}
			catch (Exception excepcion)
			{
				excepcion.printStackTrace();
			}
		}
		return categorias;
	}
}
